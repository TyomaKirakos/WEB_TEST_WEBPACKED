(()=>{"use strict";const t=()=>{if(!localStorage.users){let t={id:0,role:1,login:"Admin",password:"admin",bestResult:0,lastResult:0,bestResultTime:"0:00"};localStorage.setItem("users",JSON.stringify([t]))}},e=()=>{const t=document.querySelector(".authorized-btns"),e=document.querySelector(".not-authorized-btns");localStorage.currentUser||localStorage.setItem("currentUser","none"),"none"==localStorage.currentUser?(t.style.display="none",e.style.display="flex"):(t.style.display="flex",e.style.display="none")},s=()=>{const t=document.querySelector(".fast-test-btn"),e=document.querySelector(".marathon-btn"),s=document.querySelector(".welcome-block-btns__result-btn"),l=document.querySelector("body");let a=JSON.parse(localStorage.tasks);function n(t,e){"none"==localStorage.currentUser?o(e):a.length<5?o("Тест пройти не получится :( В нашей базе по какой-то причине недостаточно заданий!"):window.location.href=t}function o(t){document.querySelector(".modal")&&document.querySelector(".modal").remove();let e=document.createElement("div");e.classList.add("modal"),e.innerHTML='<p class="modal__text just-text">'+t+"</p>",l.append(e),setTimeout((()=>{e.remove()}),2e3)}t.addEventListener("click",(()=>{n("start-fast-test.html","Войдите или зарегистрируйтесь, чтобы пройти быстрый тест!")})),e.addEventListener("click",(()=>{n("start-marathon-test.html","Войдите или зарегистрируйтесь, чтобы пройти марафон!")})),s.addEventListener("click",(()=>{"none"==localStorage.currentUser?o("Войдите или зарегистрируйтесь, чтобы увидеть таблицу лучших результатов!"):window.location.href="best-results.html"}))},l=()=>{window.addEventListener("click",(t=>{t.target.classList.contains("logout-btn")&&(localStorage.currentUser="none",window.location.href="index.html")}))},a=()=>{if(!localStorage.tasks){let t=[{id:0,question:"Какой тег позволяет создавать заголовки?",options:["<h2>","<p>","<heading>","<strong>"],rightAnswers:["<h2>"]},{id:1,question:"Как должен начинаться HTML файл?",options:["<link type='html'>","<html>","<!DOCTYPE html>","<!DOCTYPE>"],rightAnswers:["<!DOCTYPE html>"]},{id:2,question:"Как объявляются функции в JavaScript?",options:["def","void","fun","function"],rightAnswers:["function"]},{id:3,question:"Есть такой HTML-код: <p><span class='blue'>Синий</span> не синий</p>. Какой CSS-код внутри тега <span> сделает синий цвет:",options:["Все представленные варианты подойдут","p span {color: blue;}","span {color: blue;}",".blue {color: blue;}"],rightAnswers:["Все представленные варианты подойдут"]},{id:4,question:"Как правильно вставляются комментарии в CSS-код?",options:["# Мой комментарий","/* Мой комментарий */","# Мой комментарий #","// Мой комментарий"],rightAnswers:["/* Мой комментарий */"]},{id:5,question:"Где можно использовать JavaScript?",options:["Веб-приложения","Мобильные приложения","Серверные приложения","Во всех перечисленных"],rightAnswers:["Во всех перечисленных"]},{id:6,question:"Как можно объявить переменную в JavaScript?",options:["let a;","const a;","var a;","$a"],rightAnswers:["let a;","var a;"]}];localStorage.setItem("tasks",JSON.stringify(t))}},n=(t,e)=>{const s=document.querySelector(".link-block-without-stopwatch"),l=document.querySelector(".test-page-link-to-main"),a=document.querySelector(".test-page__tasks-block"),n=document.querySelector(".test-page__finish-btn"),o=document.querySelector(".main__content"),i=document.querySelector(".test-page");let r,c,d,p,u=JSON.parse(localStorage.users),_=localStorage.currentUser;s.style.display="none",e.forEach(((t,e)=>{let s=document.createElement("div");s.classList.add("test-page__task-block","task-block",`task-order_${e}`),s.setAttribute("id",`taskId_${t.id}`),s.innerHTML=`<xmp class="task-block__task-text blue-bold-text">${t.question}</xmp>`,1==t.rightAnswers.length?s.innerHTML+=`<div class="task-block__task-options task-options" id="task-options_${t.id}">\n            \n            <label for="task${t.id}_0" class="task-options__task-option"><input type="radio" class="task-option__radio-input task-option__input" name="taskId_${t.id}" value="${t.options[0]}" id="task${t.id}_0"><xmp class="task-option__option-text just-text">${t.options[0]}</xmp></label>\n\n            <label for="task${t.id}_1" class="task-options__task-option"><input type="radio" class="task-option__radio-input task-option__input" name="taskId_${t.id}" value="${t.options[1]}" id="task${t.id}_1"><xmp class="task-option__option-text just-text">${t.options[1]}</xmp></label>\n\n            <label for="task${t.id}_2" class="task-options__task-option"><input type="radio" class="task-option__radio-input task-option__input" name="taskId_${t.id}" value="${t.options[2]}" id="task${t.id}_2"><xmp class="task-option__option-text just-text">${t.options[2]}</xmp></label>\n            \n            <label for="task${t.id}_3" class="task-options__task-option"><input type="radio" class="task-option__radio-input task-option__input" name="taskId_${t.id}" value="${t.options[3]}" id="task${t.id}_3"><xmp class="task-option__option-text just-text">${t.options[3]}</xmp></label>\n            </div>`:s.innerHTML+=`<div class="task-block__task-options task-options" id="task-options_${t.id}">\n            <label for="task${t.id}_0" class="task-options__task-option"><input type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${t.id}" value="${t.options[0]}" id="task${t.id}_0"><xmp class="task-option__option-text just-text">${t.options[0]}</xmp></label>\n\n            <label for="task${t.id}_1" class="task-options__task-option"><input type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${t.id}" value="${t.options[1]}" id="task${t.id}_1"><xmp class="task-option__option-text just-text">${t.options[1]}</xmp></label>\n\n            <label for="task${t.id}_2" class="task-options__task-option"><input type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${t.id}" value="${t.options[2]}" id="task${t.id}_2"><xmp class="task-option__option-text just-text">${t.options[2]}</xmp></label>\n            \n            <label for="task${t.id}_3" class="task-options__task-option"><input type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${t.id}" value="${t.options[3]}" id="task${t.id}_3"><xmp class="task-option__option-text just-text">${t.options[3]}</xmp></label>\n            </div>`,s.innerHTML+="</div>",a.append(s)})),n.addEventListener("click",(function(){r=0,c=0;let t=document.querySelectorAll(".task-options");e.forEach((t=>{c+=t.rightAnswers.length})),t.forEach((t=>{let s=t.id;s=s.split("_"),s=s[s.length-1],t.querySelectorAll(".task-option__input").forEach((t=>{if(t.checked){let l=e.find((t=>t.id==s));t.classList.contains("task-option__radio-input")?t.value==l.rightAnswers[0]&&r++:t.value!=l.rightAnswers[0]&&t.value!=l.rightAnswers[1]&&t.value!=l.rightAnswers[2]&&t.value!=l.rightAnswers[3]||r++}}))})),d=Math.round(100/c*r),p=document.querySelector(".test-stopwatch").textContent,function(){s.style.display="block",l.style.display="none";let t=document.createElement("div");t.classList.add("main__result-page","result-page"),t.innerHTML=d>=60?`<div class="result-page__results-block results-block">\n            <div class="results-block__result-text result-text">\n                <h1 class="result-text__heading big-heading">Ваш результат</h1>\n                <div class="result-text__result-info result-info">\n                    <div class="result-info__result-percent-block result-percent-block">\n                        <p class="result-percent-block__percent"><span class="percent__percent-number">${d}</span>%</p>\n                        <div class="result-percent-block__percent-diagram percent-diagram">\n                            <div class="percent-diagram__percent-line"></div>\n                        </div>\n                    </div>\n                    <p class="result-info__text-info just-text">\n                        Правильные ответы <span class="text-info__right-answers-num">${r}</span>/<span class="text-info__all-answers-num">${c}</span>\n                    </p>\n                    <p class="result-info__text-info just-text">\n                        Время прохождения <span class="text-info__time">${p}</span>\n                    </p>\n                </div>\n            </div>\n            <img src="img/tests-results/good-result.svg" alt="Хороший результат!" class="results-block__result-img img">\n        </div>\n        <div class="result-page__result-block-btns result-block-btns btns-block">\n            <a href="index.html" class="result-block-btns__end-btn end-btn">Завершить</a>\n            <a href="start-marathon-test.html" class="result-block-btns__retake-test-btn retake-marathon-test-btn btn">Пройти ещё раз</a>\n            <a href="best-results.html" class="results-btn btn result-block-btns__results-btn">Лучшие результаты</a>\n        </div>`:`<div class="result-page__results-block results-block">\n            <div class="results-block__result-text result-text">\n                <h1 class="result-text__heading big-heading">Ваш результат</h1>\n                <div class="result-text__result-info result-info">\n                    <div class="result-info__result-percent-block result-percent-block">\n                        <p class="result-percent-block__percent"><span class="percent__percent-number">${d}</span>%</p>\n                        <div class="result-percent-block__percent-diagram percent-diagram">\n                            <div class="percent-diagram__percent-line"></div>\n                        </div>\n                    </div>\n                    <p class="result-info__text-info just-text">\n                        Правильные ответы <span class="text-info__right-answers-num">${r}</span>/<span class="text-info__all-answers-num">${c}</span>\n                    </p>\n                    <p class="result-info__text-info just-text">\n                        Время прохождения <span class="text-info__time">${p}</span>\n                    </p>\n                </div>\n            </div>\n            <img src="img/tests-results/bad-result.svg" alt="Ты можешь лучше!" class="results-block__result-img img">\n        </div>\n        <div class="result-page__result-block-btns result-block-btns btns-block">\n            <a href="index.html" class="result-block-btns__end-btn end-btn">Завершить</a>\n            <a href="start-marathon-test.html" class="result-block-btns__retake-test-btn retake-marathon-test-btn btn">Пройти ещё раз</a>\n            <a href="best-results.html" class="results-btn btn result-block-btns__results-btn">Лучшие результаты</a>\n        </div>`,i.remove(),o.append(t),document.querySelector(".percent-diagram__percent-line").style.width=`${d}%`,window.scrollTo(0,0),u[_].lastResult=d,u[_].bestResult<=d&&(u[_].bestResult=d,u[_].bestResultTime=p.trim()),localStorage.users=JSON.stringify(u)}()}))},o=()=>{const t=document.querySelector(".test-stopwatch__minutes"),e=document.querySelector(".test-stopwatch__seconds"),s=document.querySelector(".test-page__finish-btn");let l,a;function n(){l++,60==l?(t.textContent=Number(t.textContent)+1,e.textContent="00",l=0):1==String(l).length?e.textContent="0"+l:e.textContent=l}window.addEventListener("load",(()=>{l=0,a=setInterval(n,1e3)})),s.addEventListener("click",(function(){clearInterval(a)}))};let i=document.location.href;i=i.split("/"),i=i[i.length-1],"login.html"==i?(()=>{const t=document.querySelector(".login-input"),e=document.querySelector(".password-input"),s=document.querySelector(".login-btn"),l=document.querySelector(".submit-block__log-reg-error-text"),a=/^\w+$/;let n=JSON.parse(localStorage.users),o=!1;localStorage.currentUser="none",t.addEventListener("input",(function(){" "==t.value[t.value.length-1]&&(t.value=t.value.slice(0,-1))})),e.addEventListener("input",(function(){" "==e.value[e.value.length-1]&&(e.value=e.value.slice(0,-1))})),s.addEventListener("click",(s=>{""==e.value||""==t.value?(l.textContent="Заполните все поля",l.style.display="block"):t.value.includes(" ")||e.value.includes(" ")?(l.textContent="Недопустимы пробелы",l.style.display="block"):a.test(t.value)?(n.forEach((s=>{s.login==t.value.trim()&&(o=!0,s.password==e.value.trim()?(localStorage.currentUser=s.id,window.location.href="profile.html"):(l.textContent="Неверный пароль",l.style.display="block"))})),0==o&&(l.textContent="Такого логина нет",l.style.display="block")):(l.textContent="Введены недопустимые символы",l.style.display="block"),s.preventDefault()}))})():"registration.html"==i?(()=>{const t=document.querySelector(".login-input"),e=document.querySelector(".password-input"),s=document.querySelector(".register-btn"),l=document.querySelector(".incorrect-log-error"),a=document.querySelector(".incorrect-pswd-error"),n=/^\w+$/,o=/^[^\s]*$/;let i=!1,r=JSON.parse(localStorage.users);localStorage.currentUser="none",t.addEventListener("input",(function(){" "==t.value[t.value.length-1]&&(t.value=t.value.slice(0,-1))})),e.addEventListener("input",(function(){" "==e.value[e.value.length-1]&&(e.value=e.value.slice(0,-1))})),s.addEventListener("click",(s=>{if(l.style.display="none",a.style.display="none",""==t.value?(l.textContent="Введите логин",l.style.display="block"):t.value.length<5||t.value.length>20?(l.textContent="Логин от 5 до 20 символов",l.style.display="block"):t.value.includes(" ")?(l.textContent="Недопустимы пробелы",l.style.display="block"):n.test(t.value)||(l.textContent="Недопустимые символы",l.style.display="block"),""==e.value?(a.textContent="Введите пароль",a.style.display="block"):e.value.length<5||e.value.length>40?(a.textContent="Пароль от 5 до 40 символов",a.style.display="block"):e.value.includes(" ")&&(a.textContent="Недопустимы пробелы",a.style.display="block"),r.forEach((e=>{e.login==t.value.trim()&&(i=!0)})),i)l.textContent="Логин уже занят",l.style.display="block";else if(t.value.length>=5&&e.value.length>=5&&t.value.length<=20&&e.value.length<=40&&n.test(t.value)&&o.test(e.value)){let s={id:r.length,role:0,login:t.value.trim(),password:e.value.trim(),bestResult:0,lastResult:0,bestResultTime:"0:00"};r.push(s),localStorage.setItem("users",JSON.stringify(r)),localStorage.currentUser=s.id,window.location.href="profile.html"}s.preventDefault()}))})():"profile.html"==i?(()=>{const t=document.querySelector(".login-info"),e=document.querySelector(".level-info"),s=document.querySelector(".best-result"),l=document.querySelector(".last-result"),a=document.querySelector(".time-of-best"),n=document.querySelector(".edit-tasks-btn");let o=JSON.parse(localStorage.users).find((t=>t.id==localStorage.currentUser));t.textContent=o.login,s.textContent=o.bestResult+"%",l.textContent=o.lastResult+"%",a.textContent=o.bestResultTime,1==o.role?(e.textContent="Администратор",n.style.display="block"):(e.textContent="Пользователь",n.style.display="none")})():"start-fast-test.html"==i||"start-marathon-test.html"==i?a():"fast-test.html"==i?((()=>{let t=JSON.parse(localStorage.tasks),e=[];for(let s=0;s<5;s++){let s=Math.floor(Math.random()*t.length);e.push(t[s]),t.splice(s,1)}n(0,e)})(),o()):"marathon-test.html"==i?(o(),(()=>{let t=JSON.parse(localStorage.tasks),e=[];for(let s=0;s<JSON.parse(localStorage.tasks).length;s++){let s=Math.floor(Math.random()*t.length);e.push(t[s]),t.splice(s,1)}n(0,e)})()):"best-results.html"==i?(t(),(()=>{const t=document.querySelector(".best-result-table");let e=JSON.parse(localStorage.users);e.sort((function(t,e){return t.bestResult>e.bestResult?-1:t.bestResult<e.bestResult?1:t.bestResultTime<e.bestResultTime?-1:t.bestResultTime>e.bestResultTime?1:0})),t.innerHTML='<div class="best-result-table__table-head table-cell table-head">\n                                    <p class="table-cell__text just-text">№</p>\n                                </div>\n                                <div class="best-result-table__table-head table-cell table-head">\n                                    <p class="table-cell__text just-text">Ник</p>\n                                </div>\n                                <div class="best-result-table__table-head table-cell table-head">\n                                    <p class="table-cell__text just-text">Время</p>\n                                </div>\n                                <div class="best-result-table__table-head table-cell table-head">\n                                    <p class="table-cell__text just-text">Счёт</p>\n                                </div>';for(let s=0;s<10;s++)e[s]?"0:00"!=e[s].bestResultTime?t.innerHTML+=`<div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text">${s+1}</p>\n                                            </div>\n                                            <div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text">${e[s].login}</p>\n                                            </div>\n                                            <div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text">${e[s].bestResultTime}</p>\n                                            </div>\n                                            <div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text">${e[s].bestResult}%</p>\n                                            </div>`:t.innerHTML+=`<div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text">${s+1}</p>\n                                            </div>\n                                            <div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text"></p>\n                                            </div>\n                                            <div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text"></p>\n                                            </div>\n                                            <div class="best-result-table__table-head table-cell">\n                                                <p class="table-cell__text just-text"></p>\n                                            </div>`:t.innerHTML+=`<div class="best-result-table__table-head table-cell">\n                                            <p class="table-cell__text just-text">${s+1}</p>\n                                        </div>\n                                        <div class="best-result-table__table-head table-cell">\n                                            <p class="table-cell__text just-text"></p>\n                                        </div>\n                                        <div class="best-result-table__table-head table-cell">\n                                            <p class="table-cell__text just-text"></p>\n                                        </div>\n                                        <div class="best-result-table__table-head table-cell">\n                                            <p class="table-cell__text just-text"></p>\n                                        </div>`})()):"task-redactor.html"==i?(a(),(()=>{const t=document.querySelector(".task-redactor-page");JSON.parse(localStorage.tasks).forEach(((e,s)=>{let l=document.createElement("div");l.classList.add("test-page__task-block","task-block","task-order_"+s),l.id=e.id,l.innerHTML=`<button class="task-block__delete-task-btn btn">+</button>\n        <p class="task-block__task-info blue-bold-text">ID: ${e.id}</p>\n        <xmp class="task-block__task-text blue-bold-text">${e.question}</xmp>`;let a=document.createElement("div");a.classList.add("task-block__task-options","task-options"),a.id="task-options_"+e.id,1==e.rightAnswers.length?a.innerHTML=`<label for="task${e.id}_0" class="task-options__task-option"><input disabled type="radio" class="task-option__radio-input task-option__input" name="taskId_${e.id}" value="${e.options[0]}" id="task${e.id}_0"><xmp class="task-option__option-text just-text">${e.options[0]}</xmp></label>\n\n            <label for="task${e.id}_1" class="task-options__task-option"><input disabled type="radio" class="task-option__radio-input task-option__input" name="taskId_${e.id}" value="${e.options[1]}" id="task${e.id}_1"><xmp class="task-option__option-text just-text">${e.options[1]}</xmp></label>\n\n            <label for="task${e.id}_2" class="task-options__task-option"><input disabled type="radio" class="task-option__radio-input task-option__input" name="taskId_${e.id}" value="${e.options[2]}" id="task${e.id}_2"><xmp class="task-option__option-text just-text">${e.options[2]}</xmp></label>\n            \n            <label for="task${e.id}_3" class="task-options__task-option"><input disabled type="radio" class="task-option__radio-input task-option__input" name="taskId_${e.id}" value="${e.options[3]}" id="task${e.id}_3"><xmp class="task-option__option-text just-text">${e.options[3]}</xmp></label>`:a.innerHTML=`<label for="task${e.id}_0" class="task-options__task-option"><input disabled type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${e.id}" value="${e.options[0]}" id="task${e.id}_0"><xmp class="task-option__option-text just-text">${e.options[0]}</xmp></label>\n\n            <label for="task${e.id}_1" class="task-options__task-option"><input disabled type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${e.id}" value="${e.options[1]}" id="task${e.id}_1"><xmp class="task-option__option-text just-text">${e.options[1]}</xmp></label>\n\n            <label for="task${e.id}_2" class="task-options__task-option"><input disabled type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${e.id}" value="${e.options[2]}" id="task${e.id}_2"><xmp class="task-option__option-text just-text">${e.options[2]}</xmp></label>\n            \n            <label for="task${e.id}_3" class="task-options__task-option"><input disabled type="checkbox" class="task-option__checkbox task-option__input" name="taskId_${e.id}" value="${e.options[3]}" id="task${e.id}_3"><xmp class="task-option__option-text just-text">${e.options[3]}</xmp></label>`,l.append(a),t.append(l)}))})(),(()=>{const t=document.querySelector(".task-redactor-page");let e=JSON.parse(localStorage.tasks);const s=()=>{if(1==document.querySelectorAll(".task-block").length){let e=document.createElement("p");e.classList.add("blue-bold-text","task-redactor-page__warning-text"),e.textContent="Заданий нет :(",t.append(e)}};s(),t.addEventListener("click",(t=>{if(t.target.classList.contains("task-block__delete-task-btn")){let s=t.target.parentNode,l=e.find((t=>t.id==s.id)),a=e.indexOf(l);e.splice(a,1),s.remove(),localStorage.tasks=JSON.stringify(e)}s()}))})(),(()=>{const t=document.querySelector(".add-task-btn"),e=document.querySelector(".modal-area");t.addEventListener("click",(()=>{e.style.display="grid"})),e.addEventListener("click",(t=>{(t.target.classList.contains("modal-window__close-btn")||t.target.classList.contains("modal-area"))&&(e.style.display="none")}))})(),(()=>{const t=document.querySelector(".add-task-form"),e=t.querySelector(".task-block__task-text"),s=t.querySelectorAll(".task-option__checkbox"),l=t.querySelector(".add-task-form__error-text");function a(t){return(t=t.trim()).replaceAll('"',"'")}t.querySelector(".add-task-form__add-btn").addEventListener("click",(t=>{let n;t.preventDefault();let o=JSON.parse(localStorage.tasks);n=0!=o.length&&o?o.reduce(((t,e)=>t.id>e.id?t:e)).id+1:0;let i=[],r=[],c=!1,d=!0;l.style.opacity=0;let p=e.value;if(p=a(p),s.forEach((t=>{let e=t.parentNode.querySelector(".task-option__option-text").value;e=a(e),""==e?d=!1:i.push(e),t.checked&&(c=!0,r.push(e))})),""==p||0==c||0==d)i=[],r=[],l.style.opacity=1;else{let t={id:n,question:p,options:i,rightAnswers:r};o.push(t),localStorage.tasks=JSON.stringify(o),location.reload()}}))})()):"index.html"==i?(a(),e(),t(),s(),l()):(e(),t(),s(),l()),l()})();